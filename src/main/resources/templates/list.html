<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
  <meta charset="UTF-8" />
  <title>Items</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    .top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; gap: 12px; }
    .right { display: flex; align-items: center; gap: 10px; }
    a.btn, button.btn { padding: 8px 12px; border: 1px solid #333; text-decoration: none; background: transparent; cursor: pointer; }
    table { border-collapse: collapse; width: 520px; max-width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { text-align: left; }
    .muted { color: #666; font-size: 0.9rem; }
  </style>
</head>

<body>
<div class="top">
  <div>
    <h1>Items</h1>
    <div class="muted">
      Signed in as: <span sec:authentication="name">user</span>
      |
      Roles: <span sec:authentication="authorities">ROLE_USER</span>
    </div>
  </div>

  <div class="right">
    <!-- Кнопка создания только для ADMIN -->
    <a class="btn" th:href="@{/items/new}" sec:authorize="hasRole('ADMIN')">Create new</a>

    <!-- Logout (POST) -->
    <form th:action="@{/logout}" method="post" style="margin: 0;">
      <button class="btn" type="submit">Logout</button>
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
    </form>
  </div>
</div>

<table>
  <thead>
  <tr>
    <th>ID</th>
    <th>Name</th>

    <!-- Колонка Actions только для ADMIN -->
    <th sec:authorize="hasRole('ADMIN')">Actions</th>
  </tr>
  </thead>

  <tbody>
  <tr th:if="${#lists.isEmpty(items)}">
    <td colspan="3">No items yet.</td>
  </tr>

  <tr th:each="it : ${items}">
    <td th:text="${it.id}"></td>
    <td th:text="${it.name}"></td>

    <!-- Edit только для ADMIN -->
    <td sec:authorize="hasRole('ADMIN')">
      <a th:href="@{/items/{id}/edit(id=${it.id})}">Edit</a>
    </td>
  </tr>
  </tbody>
</table>

<!-- Сообщение для USER -->
<p class="muted" sec:authorize="hasRole('USER')">
  You are logged in as USER. Creating/editing items is available for ADMIN only.
</p>
</body>
</html>
